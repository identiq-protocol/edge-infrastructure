# More examples of Codefresh YAML can be found at
# https://codefresh.io/docs/docs/yaml-examples/examples/

version: "1.0"
steps:
  clone:
    title: "Cloning repository"
    type: "git-clone"
    repo: "identiq-protocol/edge-infrastructure"
    revision: master
    git: "codefresh"
  get_latest_tag:
    title: get latest tag
    image: alpine/git:latest
    working_directory: /codefresh/volume/${{CF_REPO_NAME}}
    commands:
      - git checkout master
      - cf_export LATEST_TAG=`git describe --tags --abbrev=0`
  bumpVersion:
    type: semversioner
    arguments:
      SEMVERSIONER_VERSION: ${{LATEST_TAG}}
      SEMVERSIONER_ACTION: bump
      SEMVERSIONER_PART: patch
  checkVersion:
    image: alpine
    commands:
    - 'echo VERSION=${{steps.bumpVersion.output.SEMVERSIONER_RESULT}}'
  github_release:
    type: github-release
    title: Typical usage example
    description: |-
      The git_context_name, repo_owner and repo_name vars
      will be taken automatically from the trigger.
      Requires the pipeline to be started by a github trigger
    arguments:
      release_tag: ${{SEMVERSIONER_RESULT}}
